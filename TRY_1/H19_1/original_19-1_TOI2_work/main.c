/***********************************/
/*  main.c                         */
/*   ±½ÚÁ¯¸ ¸×ÌÞ ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ */
/***********************************/
#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

#include "common.h"
#include "main.h"
#include "nyuukai.h"
#include "keisoku.h"
#include "sakujyo.h"

/***********************************/
/* ·®³Â³ ÃÞ°À                      */
/***********************************/

/* ±·º°ÄÞ Ë®³ */
int akicode_tbl[ MEMBER_MAX + 1 ];

/* º°ÄÞÃÞ°À À²¼®³ Ë®³ */
int codedata_tbl[ MEMBER_MAX ];

/* º¼ÞÝÍÞÂ ¹²¿¸ ÃÞ°ÀË®³ */
struct KEISOKU_TBL kojin_keisoku_tbl;

/* ¿°Ä Ö³ ¹²¿¸ ÃÞ°À Ë®³ */
struct KEISOKU_TBL sort_keisoku_tbl[ MEMBER_MAX ];


/***********************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ               */
/*  Ò²Ý                            */
/*   Êß×Ò°À : Å¼                   */
/*   ØÀ°Ý   : Å¼                   */
/***********************************/
int main( void )
#ifdef TOI2
{
    int    loop = TRUE;			/* Ù°Ìß Ì×¸Þ                */
    char   work[ 128 ];			/* Æ­³Ø®¸ Ü°¸               */
    FILE   *fp;				/* Ì§²Ù Îß²ÝÀ               */
    char   *fname1 = AKICODE_TBL_NAME;	/* ±· º°ÄÞ Ë®³ Ì§²Ù         */
    char   *fname2 = CODEDATA_TBL_NAME;	/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù */
    int	   i;				/* ²ÝÃÞ¯¸½		    */

    /* ±· º°ÄÞ Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname1, "rb" )) == NULL ) {
        printf( "\n ±· º°ÄÞ Ë®³ Ì§²Ù ¦ »¸¾² ¼Ã²Ï½¡" );

        /* ±· º°ÄÞ Ë®³ Ì§²Ù »¸¾² */
        akicode_tbl_create( );
    }
    else {
        /* ±· º°ÄÞ Ë®³ Ì§²Ù CLOSE */
        fclose( fp );
    }

    /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname2, "rb" )) == NULL ) {
        printf( "\n º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù ¦ »¸¾² ¼Ã²Ï½¡" );

        /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù »¸¾² */
        codedata_tbl_create( );
    }
    else {
        /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù CLOSE */
        fclose( fp );
    }

    while( loop ) {
        /* Ã°ÌÞÙ ¼®· ¸Ø± */
		akicode_tbl[ 0 ] = 0;
		for( i = 0; i < MEMBER_MAX; i++) {
			akicode_tbl[ i + 1 ] = 0;
			codedata_tbl[ i ] = 0;
			sort_keisoku_tbl[ i ] = init_kojin_keisoku_tbl();
		}
		kojin_keisoku_tbl = init_kojin_keisoku_tbl();

        printf( "\n" );
        printf( "\n *******************************" );
        printf( "\n  ±½ÚÁ¯¸ ¸×ÌÞ ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ " );
        printf( "\n *******************************" );
        printf( "\n ¼®Ø ¦ ¾ÝÀ¸ ¼Ã¸ÀÞ»²" );
        printf( "\n 1:Æ­³¶² Ä³Û¸" );
        printf( "\n 2:¹²¿¸ ·Û¸ Æ­³Ø®¸" );
        printf( "\n 3:Ä³Û¸ »¸¼Þ®" );
        printf( "\n 4:Îß²ÝÄË®³¼Þ");
        printf( "\n 5:ÃÞ°ÀÉË®³¼Þ");
        printf( "\n E:¼­³Ø®³" );
        printf( "\n ? " );

        /* ¼®Ø¸ÌÞÝ Æ­³Ø®¸ */
        work[ 0 ] = '\0';
        scanf( "%s", work );

        /* Æ­³Ø®¸ ¹À½³ Áª¯¸ -> 1²¶Þ² ? */
        if( strlen( work ) != 1 ) {
            printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
            continue;
        }

        switch( work[ 0 ] ) {
            case '1':       /* Æ­³¶² Ä³Û¸     */
                nyuukai_touroku( );
                break;

            case '2':       /* ¹²¿¸ ·Û¸ ¼­³¹² */
                keisoku_input( );
                break;

            case '3':       /* Ä³Û¸ »¸¼Þ®     */
                touroku_sakujyo( );
                break;

            case '4':       /* Îß²ÝÄË®³¼Þ     */
                point_rank( );
                break;

            case '5':       /* ÃÞ°ÀË®³¼Þ     */
                show_data( );
                break;

            case 'e':       /* ¼­³Ø®³         */
            case 'E':
                loop = FALSE;
                break;

            default:
                printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
                break;
        }
    }
    return OK;
}
#else
{
	int    loop = TRUE;			/* Ù°Ìß Ì×¸Þ                */
	char   work[ 128 ];			/* Æ­³Ø®¸ Ü°¸               */
	FILE   *fp;				/* Ì§²Ù Îß²ÝÀ               */
	char   *fname1 = AKICODE_TBL_NAME;	/* ±· º°ÄÞ Ë®³ Ì§²Ù         */
	char   *fname2 = CODEDATA_TBL_NAME;	/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù */
	int	   i;				/* ²ÝÃÞ¯¸½		    */

	/* ±· º°ÄÞ Ë®³ Ì§²Ù OPEN -> NULL ? */
	if( (fp = fopen( fname1, "rb" )) == NULL ) {
		printf( "\n ±· º°ÄÞ Ë®³ Ì§²Ù ¦ »¸¾² ¼Ã²Ï½¡" );

		/* ±· º°ÄÞ Ë®³ Ì§²Ù »¸¾² */
		akicode_tbl_create( );
	}
	else {
		/* ±· º°ÄÞ Ë®³ Ì§²Ù CLOSE */
		fclose( fp );
	}

	/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù OPEN -> NULL ? */
	if( (fp = fopen( fname2, "rb" )) == NULL ) {
		printf( "\n º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù ¦ »¸¾² ¼Ã²Ï½¡" );

		/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù »¸¾² */
		codedata_tbl_create( );
	}
	else {
		/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù CLOSE */
		fclose( fp );
	}

	while( loop ) {
		/* Ã°ÌÞÙ ¼®· ¸Ø± */
		akicode_tbl[ 0 ] = 0;
		for( i = 0; i < MEMBER_MAX; i++) {
			akicode_tbl[ i + 1 ] = 0;
			codedata_tbl[ i ] = 0;
			sort_keisoku_tbl[ i ] = init_kojin_keisoku_tbl();
		}
		kojin_keisoku_tbl = init_kojin_keisoku_tbl();

		printf( "\n" );
		printf( "\n *******************************" );
		printf( "\n  ±½ÚÁ¯¸ ¸×ÌÞ ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ " );
		printf( "\n *******************************" );
		printf( "\n ¼®Ø ¦ ¾ÝÀ¸ ¼Ã¸ÀÞ»²" );
		printf( "\n 1:Æ­³¶² Ä³Û¸" );
		printf( "\n 2:¹²¿¸ ·Û¸ Æ­³Ø®¸" );
		printf( "\n 3:Ä³Û¸ »¸¼Þ®" );
		printf( "\n E:¼­³Ø®³" );
		printf( "\n ? " );

		/* ¼®Ø¸ÌÞÝ Æ­³Ø®¸ */
		work[ 0 ] = '\0';
		scanf( "%s", work );

		/* Æ­³Ø®¸ ¹À½³ Áª¯¸ -> 1²¶Þ² ? */
		if( strlen( work ) != 1 ) {
			printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
			continue;
		}

		switch( work[ 0 ] ) {
			case '1':       /* Æ­³¶² Ä³Û¸     */
				nyuukai_touroku( );
				break;

			case '2':       /* ¹²¿¸ ·Û¸ ¼­³¹² */
				keisoku_input( );
				break;

			case '3':       /* Ä³Û¸ »¸¼Þ®     */
				touroku_sakujyo( );
				break;

			case 'e':       /* ¼­³Ø®³         */
			case 'E':
				loop = FALSE;
				break;

			default:
				printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
				break;
		}
	}
	return OK;
}
#endif

/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*  Æ­³¶² Ä³Û¸ ¼®Ø                  */
/*   ±· º°ÄÞ Ë®³ Ì§²Ù »¸¾²          */
/*   Êß×Ò°À : Å¼                    */
/*   ØÀ°Ý   : 0:OK                  */
/*           -1:NG                  */
/************************************/
static int akicode_tbl_create( void )
{
    int     ret;				/* ØÀ°Ý º°ÄÞ        */
    int     i;					/* ²ÝÃÞ¯¸½          */
    FILE    *fp;				/* Ì§²Ù Îß²ÝÀ       */
    char    *fname = AKICODE_TBL_NAME;		/* ±· º°ÄÞ Ë®³ Ì§²Ù */

    /* ±· º°ÄÞ ÍÝ¼­³ */
    akicode_tbl[ 0 ] = MEMBER_MAX;
    for( i = 1; i < MEMBER_MAX + 1; i++ ) {
        akicode_tbl[ i ] = i;
    }

    /* ±· º°ÄÞ Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "w+b" )) == NULL ) {
        printf( "\n ±· º°ÄÞË®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

    /* ±· º°ÄÞ Ë®³ Ì§²Ù WRITE -> 1²¶Þ² ? */
    if( (ret = fwrite( (char *)akicode_tbl, sizeof( akicode_tbl ), 1, fp ) )
               != 1 ) {
        printf( "\n ±· º°ÄÞË®³ Ì§²Ù WRITE ´×°" );
        ret = NG;
    }
    else {
        ret = OK;
    }

    /* ±· º°ÄÞ Ë®³ Ì§²Ù CLOSE */
    fclose( fp );

    return ret;
}



/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*  Æ­³¶² Ä³Û¸ ¼®Ø                  */
/*   º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù »¸¾²  */
/*   Êß×Ò°À : Å¼                    */
/*   ØÀ°Ý   : 0:OK                  */
/*           -1:NG                  */
/************************************/
static int codedata_tbl_create( void )
{
    int     ret;                        	/* ØÀ°Ý º°ÄÞ                */
    FILE    *fp;                        	/* Ì§²Ù Îß²ÝÀ               */
    char    *fname = CODEDATA_TBL_NAME;		/* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù */
    int	    i;					/* ²ÝÃÞ¯¸½		    */

    /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "w+b" )) == NULL ) {
        printf( "\n º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

	for( i = 0; i < MEMBER_MAX; i++ )
		codedata_tbl[ i ] = 0;

    /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù WRITE -> 1²¶Þ² ? */
    if( (ret = fwrite( (char *)codedata_tbl, sizeof( codedata_tbl ), 1, fp ) )
               != 1 ) {
        /* WRITE ´×° */
        printf( "\n º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù WRITE ´×°" );
        ret = NG;
    }
    else {
        ret = OK;
    }

    /* º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù CLOSE */
    fclose( fp );

    return ret;
}



/************************************/
/* ·®³Â³ Ù°ÁÝ                       */
/************************************/


/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*  Æ­³¶² Ä³Û¸ ¼®Ø                  */
/*   ±· º°ÄÞ Ë®³ Ì§²Ù READ          */
/*   Êß×Ò°À : Å¼                    */
/*   ØÀ°Ý   : 0:OK                  */
/*           -1:NG                  */
/************************************/
int akicode_tbl_read( void )
{
    int     ret;				/* ØÀ°Ý º°ÄÞ        */
    int     i;					/* ²ÝÃÞ¯¸½          */
    FILE    *fp;				/* Ì§²Ù Îß²ÝÀ       */
    char    *fname = AKICODE_TBL_NAME;		/* ±· º°ÄÞ Ë®³ Ì§²Ù */

    /* ±· º°ÄÞ Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "rb" )) == NULL ) {
        printf( "\n ±· º°ÄÞ Ë®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

    for( i = 0; i < MEMBER_MAX + 1; i++ ) {
        /* ±· º°ÄÞ Ë®³ Ì§²Ù READ -> 1²¶Þ² ? */
        if( (ret = fread( (char *)&akicode_tbl[ i ], sizeof( int ), 1, fp ) )
                   != 1 ) {
            /* READ ´×° ±Ø ? */
            if( ferror( fp ) != 0 ) {
                printf( "\n ±· º°ÄÞ Ë®³ Ì§²Ù READ ´×°" );
                ret = NG;
            }
            else {
                /* Ì§²Ù EOF ÃÞ Å² ? */
                if( feof( fp ) == 0 ) {
                    printf( "\n ±· º°ÄÞ Ë®³ Ì§²Ù READ ´×°" );
                    ret = NG;
                }
                else {
                    ret = OK;
                }
            }
            break;
        }
#ifdef DEBUG
        printf("[%s:%d]\n", __FILE__, __LINE__);
        printf("akicode_tbl[%d]=%d\n",
        			i, akicode_tbl[i]);
        printf("\n");
#endif
    }

#ifdef DEBUG
    /* Show a part of akicode_tbl[] */
    printf("[%s:%d]\n", __FILE__, __LINE__);
    printf("akicode_tbl[]\n");
    for(i = 0; i < 10; i++) {
    	printf("akicode_tbl[%d]=%c(%%d=%d)\n",
    			i, akicode_tbl[i], akicode_tbl[i]);

    }
    printf("\n");
#endif

    /* ±· º°ÄÞ Ë®³ Ì§²Ù CLOSE */
    fclose( fp );

    return ret;
}



/***********************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ               */
/*  Æ­³Ø®¸ ¶¸ÆÝ                    */
/*   Êß×Ò°À : ¶¸ÆÝ Ò¯¾°¼Þ          */
/*   ØÀ°Ý   : 0:OK                 */
/*           -1:NG                 */
/***********************************/
int kakunin_input( char *msg )
{
    int     ret;            /* ØÀ°Ý º°ÄÞ    */
    int     loop = TRUE;    /* Ù°Ìß Ì×¸Þ    */
    char    work[ 128 ];    /* Æ­³Ø®¸ Ü°¸   */

    while( loop ) {
        /* ¶¸ÆÝ Ë®³¼Þ */
        printf( msg );
        printf( "\n ? " );

        /* Y/N Æ­³Ø®¸ */
        work[ 0 ] = '\0';
        scanf( "%s", work );

        /* Æ­³Ø®¸ ¹À½³ Áª¯¸ -> 1²¶Þ² ? */
        if( strlen( work ) != 1 ) {
            printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
            continue;
        }

        switch( work[ 0 ] ) {
            case 'Y':   /* Yes */
            case 'y':
                ret  = OK;
                loop = FALSE;
                break;

            case 'N':   /* No */
            case 'n':
                ret  = NG;
                loop = FALSE;
                break;

            default:
                printf( "\n Æ­³Ø®¸ Ð½ ÃÞ½" );
                break;
        }
    }

    return ret;
}



/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*   º¼ÞÝ ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù READ   */
/*   Êß×Ò°À : ¶²²Ýº°ÄÞ              */
/*   ØÀ°Ý   : 0:OK                  */
/*           -1:NG                  */
/************************************/
int kojin_data_read( int kaiin_code )
{
    int     ret;				/* ØÀ°Ý º°ÄÞ                */
    FILE    *fp;				/* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù Îß²ÝÀ */
    long    fptr;				/* ¹²¿¸ ÃÞ°À Ì§²Ù Îß²ÝÀ     */
    char    *fname = KEISOKU_TBL_NAME;		/* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù       */

    /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "rb" )) == NULL ) {
        printf( "\n ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

    /* ¶Þ²Ä³ ÃÞ°À Îß²ÝÀ ¾¯Ä */
    fptr = ( codedata_tbl[ kaiin_code - 1 ] - 1 ) *
             sizeof( struct KEISOKU_TBL );

    /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù ¦ À²¼®³ É ²Á ÏÃÞ SEEK -> OK ? */
    if( (ret = fseek( fp, fptr, SEEK_SET )) != OK ) {
        printf( "\n ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù SEEK ´×°" );

        /* ¹²¿¸ ÃÞ°À  Ë®³ Ì§²Ù CLOSE */
        fclose( fp );
        return NG;
    }

    /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù READ -> 1²¶Þ² ? */
    if( (ret = fread( (char *)&kojin_keisoku_tbl, sizeof( kojin_keisoku_tbl ),
               1, fp )) != 1 ) {
        printf( "\n ¹²¿¸ ÃÞ°À Ë®³ READ ´×°" );
        ret = NG;
    }
    else {
        ret = OK;
    }

    /* ¹²¿¸ ÃÞ°À  Ë®³ Ì§²Ù CLOSE */
    fclose( fp );

    return ret;
}



/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*   ¹²¿¸ ÃÞ°À Ë®³¼Þ                */
/*   Êß×Ò°À : ¶²²Ýº°ÄÞ              */
/*            Ë®³¼Þ Ò¯¾°¼Þ          */
/*   ØÀ°Ý   : Å¼                    */
/************************************/
#ifdef TOI2
void kojin_data_disp( int kaiin_code, char *msg )
{
    printf( msg );
    printf( "\n ¶²²Ýº°ÄÞ %3d", kaiin_code );

    /* |CgÌ\¦ */
    printf( "\n\n    Îß²ÝÄ " );
    printf( "%3d", kojin_keisoku_tbl.point);

    if( kojin_keisoku_tbl.count != 0 ) {
        printf( "\n\n ¹²¿¸¶²½³   ¼®¶² ËÂÞ¹   ÃÞ°À     " );
        printf( "»²º³ ËÂÞ¹   ÃÞ°À     »²¼Ý ËÂÞ¹   ÃÞ°À" );

        printf( "\n    %3d", kojin_keisoku_tbl.count );

        printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.first_date[ 0 ],
            &kojin_keisoku_tbl.first_date[ 4 ],
            &kojin_keisoku_tbl.first_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.first_data );

		printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.max_date[ 0 ],
            &kojin_keisoku_tbl.max_date[ 4 ],
            &kojin_keisoku_tbl.max_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.max_data );

        printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.soku_date[ 0 ],
            &kojin_keisoku_tbl.soku_date[ 4 ],
            &kojin_keisoku_tbl.soku_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.soku_data[ 0 ] );

        printf( "\n\n    1¶²Ï´   2¶²Ï´   3¶²Ï´   4¶²Ï´   ");
        printf( "5¶²Ï´   6¶²Ï´   7¶²Ï´   8¶²Ï´   9¶²Ï´" );

        printf( "\n " );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 1 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 2 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 3 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 4 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 5 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 6 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 7 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 8 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 9 ] );

    }
	else {
        printf( "    ¹²¿¸ ÃÞ°À ¶Þ ±ØÏ¾Ý" );
	return;
	}
    return;
}//void kojin_data_disp( int kaiin_code, char *msg )
#else
void kojin_data_disp( int kaiin_code, char *msg )
{
    printf( msg );
    printf( "\n ¶²²Ýº°ÄÞ %3d", kaiin_code );

    if( kojin_keisoku_tbl.count != 0 ) {
        printf( "\n\n ¹²¿¸¶²½³   ¼®¶² ËÂÞ¹   ÃÞ°À     " );
        printf( "»²º³ ËÂÞ¹   ÃÞ°À     »²¼Ý ËÂÞ¹   ÃÞ°À" );

        printf( "\n    %3d", kojin_keisoku_tbl.count );

        printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.first_date[ 0 ],
            &kojin_keisoku_tbl.first_date[ 4 ],
            &kojin_keisoku_tbl.first_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.first_data );

		printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.max_date[ 0 ],
            &kojin_keisoku_tbl.max_date[ 4 ],
            &kojin_keisoku_tbl.max_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.max_data );

        printf( "    %4.4s-%2.2s-%2.2s",
            &kojin_keisoku_tbl.soku_date[ 0 ],
            &kojin_keisoku_tbl.soku_date[ 4 ],
            &kojin_keisoku_tbl.soku_date[ 6 ] );

        printf( "   %4d", kojin_keisoku_tbl.soku_data[ 0 ] );

        printf( "\n\n    1¶²Ï´   2¶²Ï´   3¶²Ï´   4¶²Ï´   ");
        printf( "5¶²Ï´   6¶²Ï´   7¶²Ï´   8¶²Ï´   9¶²Ï´" );

        printf( "\n " );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 1 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 2 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 3 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 4 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 5 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 6 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 7 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 8 ] );
        printf( "    %4d", kojin_keisoku_tbl.soku_data[ 9 ] );
    }
	else {
        printf( "    ¹²¿¸ ÃÞ°À ¶Þ ±ØÏ¾Ý" );
	return;
	}
    return;
}//void kojin_data_disp( int kaiin_code, char *msg )
#endif


/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*   ¹²¿¸ ÃÞ°À ¼®·¶                 */
/*   Êß×Ò°À : Å¼                    */
/*   ØÀ°Ý   : ¹²¿¸ ÃÞ°À             */
/************************************/
#ifdef TOI2
struct KEISOKU_TBL init_kojin_keisoku_tbl( void )
{
	static struct KEISOKU_TBL tbl = {
		0, 0, "        ", 0, "        ", 0, "        ", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0
	};
	return tbl;
}
#else
struct KEISOKU_TBL init_kojin_keisoku_tbl( void )
{
	static struct KEISOKU_TBL tbl = {
		0, 0, "        ", 0, "        ", 0, "        ", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	};
	return tbl;
}
#endif

#ifdef TOI2
/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*   |Cgf[^Ìì¬           */
/*   Êß×Ò°À :                     */
/*   ØÀ°Ý   :              */
/************************************/

/************************************/
/* ÒÝÊÞ° ¶ÝØ ÌßÛ¸Þ×Ñ                */
/*   Âlf[^Ì\¦                 */
/*   Êß×Ò°À : ïõIDikaiin_codej                    */
/*   ØÀ°Ý   : -1 => No entry with the id             */
/*			  1  => Display successful */
/************************************/
int  show_data( void )
{
	char	buf[10];	/* scan·é¶ñÌ½ßÉAPobt@[ */
	int		kaiin_code;	/* ïõR[h */

	int		i;			/* CfbNX */

    int     ret;				/* ØÀ°Ý º°ÄÞ                */
    FILE    *fp;				/* º°ÄÞ ÃÞ°À Ë®³ Ì§²Ù Îß²ÝÀ */
    long    fptr;				/* º°ÄÞ ÃÞ°À Ì§²Ù Îß²ÝÀ     */
    char    *fname = CODEDATA_TBL_NAME;		/* º°ÄÞ ÃÞ°À Ë®³ Ì§²Ù       */

    /* º°ÄÞ ÃÞ°À Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "rb" )) == NULL ) {
        printf( "\n º°ÄÞ ÃÞ°À Ë®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

    /* R[h\f[^@=>@ÇÝÝ */
    if( (ret = fread( (char *)codedata_tbl,
    		sizeof( codedata_tbl ), 1, fp ) ) != 1 ) {
		printf( "\n º°ÄÞ ÃÞ°À À²¼®³ Ë®³ Ì§²Ù READ ´×°" );
		ret = NG;
	}

	/* obt@[ðtbVµÄ¨­ */
	fflush(stdin);

	while (1) {
		/* R[hÔÌüÍ */
		printf("ïõR[hðüÍµÄ­¾³¢F");
		fgets(buf, sizeof(buf), stdin);

		/* buf ð\¦ */
		printf("[%s:%d]\n", __FILE__, __LINE__);
		printf("buf=%s(%d)\n", buf, *buf);

		/* l¶©Ç¤©Ø */
		buf[strlen(buf) - 1] = '\0';
		if( strspn( buf, "1234567890" )
				< strlen( buf ) ) {
			printf( "\n ½³Á ²¶Þ² ¶Þ Æ­³Ø®¸ »ÚÏ¼À" );
			continue;
		}
		else
			break;
		/*
		if (isdigit(buf))
			break;

		else
			printf("lÈOÌ¶Å· => %s\n", buf);
*/
	}//while (1) {

	/* üÍ³ê½ÔªA·ÅÉo^³êÄ¢é©Ø */
	//if (codedata_tbl[atoi(buf)] == 0) {
	if (codedata_tbl[atoi(buf) - 1] == 0) {
		printf("codedata_tbl[atoi(buf) - 1]=%d\n",
					codedata_tbl[atoi(buf) - 1]);
		printf("atoi(buf) - 1 = %d\n", atoi(buf) - 1);
		printf("The id %d is not registered yet.\n",
				atoi(buf));
		return -1;
	}

	/* o^f[^@=>@\¦ */
	printf("<Showing the data for ID %d ...>\n",
					atoi(buf));

	/* Âlf[^@=>@ÇÝÝ */
	kojin_data_read(atoi(buf));

	/* \¦ */
	kojin_data_disp(atoi(buf), "Data\n");

/*
	printf("Showing the data for Kaiin ID %d ...\n",
				atoi(buf));
	printf("\tNow building the program. Sorry.\n");
*/
	return 0;

}//int  show_data(int kaiin_code)

static int point_rank( void )
{
    int     ret;						/* ØÀ°Ý º°ÄÞ            */
    int     i;							/* ²ÝÃÞ¯¸½              */
    FILE    *fp;						/* Ì§²Ù Îß²ÝÀ           */
    char    *fname = KEISOKU_TBL_NAME;				/* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù   */

    //debug
    printf("[%s:%d]\n", __FILE__, __LINE__);
    printf("Start point rank\n");

    /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù OPEN -> NULL ? */
    if( (fp = fopen( fname, "rb" )) == NULL ) {
        printf( "\n ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù OPEN ´×°" );
        return NG;
    }

    /* sort_keisoku_tbl[] => set */
    i = 0;
    for( ; ; ) {

        /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù READ -> 1²¶Þ² ? */
        if( (ret = fread( (char *)&sort_keisoku_tbl[ i ],
                   sizeof( struct KEISOKU_TBL ), 1, fp )) != 1 ) {

            /* READ ´×° ? */
            if( ferror( fp ) != 0 ) {
                printf( "\n ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù READ ´×°" );
                ret = NG;
            }
            else {
                /* Ì§²Ù EOF ÃÞ Å² ? */
                if( feof( fp ) == 0 ) {
                    printf( "\n ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù READ ´×°" );
                    ret = NG;
                }
                else {
                    ret = OK;
                }
            }
        }

        /* READ ´×° ? */
        if( ret == NG ) {
            break;
        }

        /* ¹²¿¸ ÃÞ°À ±Ø ? */
        if( sort_keisoku_tbl[ i ].count != 0 ) {
            i++;
        }

        /* eof ? */
        if( ret == OK ) {
            break;
        }
    }//for( ; ; ) {

    /* ¹²¿¸ ÃÞ°À Ë®³ Ì§²Ù CLOSE */
    fclose( fp );

    if( ret == OK ) {
        /* ¹²¿¸ ÃÞ°À ¿°Ä */
    	point_sort( i );
        /* ¹²¿¸ ÃÞ°À ¿°Ä ¹¯¶ Ë®³¼Þ */
    	point_disp( i );
    }

    //debug
    printf("\n\n[%s:%d]\n", __FILE__, __LINE__);
    printf("[Exit: point_rank()\n]");

    return ret;
}//static int point_rank( int cnt )

static void point_sort( int cnt )
{
    int     i;                  	/* ²ÝÃÞ¯¸½      */
    int     j;                  	/* ²ÝÃÞ¯¸½      */
    struct  KEISOKU_TBL  work;  	/* ½Ü¯Ìß Ö³ ´Ø± */

    /* ÃÞ°À ¿°Ä */
    for( i = 0; i < cnt - 1; i++ ) {
        for( j = i + 1; j < cnt; j++ ) {
            if( sort_keisoku_tbl[ i ].point <
                sort_keisoku_tbl[ j ].point ) {

				work = sort_keisoku_tbl[ i ];
                sort_keisoku_tbl[ i ] = sort_keisoku_tbl[ j ];
                sort_keisoku_tbl[ j ] = work;
            }
        }
    }
	return;
}//static void point_sort( int cnt )

static void point_disp( int cnt )
{
    int     i;  /* ²ÝÃÞ¯¸½  */

    printf( "\n\n ** ¼Þ­Ý² Ë®³ (Îß²ÝÄ¼Þ­Ý) **" );
    printf( "\n ¼Þ­Ý² ¶²²Ýº°ÄÞ  Îß²ÝÄ" );

    for( i = 0; i < cnt; i++ ) {

        /* 10² ÏÃÞ Ë®³¼Þ ½Ù */
        if( i >= 10 ) {
            break;
        }

        printf( "\n   %2d   %3d        %4d",
        	i + 1,
            sort_keisoku_tbl[ i ].kaiin_code,
            sort_keisoku_tbl[ i ].point );
    }
	return;
}//static void point_disp( int cnt )

#endif//#ifdef TOI2

/*
 * printf("[%s:%d]\n", __FILE__, __LINE__);
 */
